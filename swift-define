# Version
SWIFT_VERSION=5.5.3
SWIFT_TARGET_ARCH=armv7
SWIFT_TARGET_NAME=armv7-unknown-linux-gnueabihf

# Configurable
SRC_ROOT="${SRC_ROOT:=/usr/src/swift-armv7}"
STAGING_DIR="${STAGING_DIR:=$SRC_ROOT/bullseye-armv7}"
SWIFT_NATIVE_PATH="${SWIFT_NATIVE_PATH:=/usr/bin}"
SWIFT_LLVM_DIR="${SWIFT_LLVM_DIR:=/usr/lib/llvm-12}"
SWIFT_BUILD_CONFIGURATION="${SWIFT_BUILD_CONFIGURATION:=Release}"
SWIFTPM_CONFIGURATION="${SWIFTPM_CONFIGURATION:=release}"
SWIFT_PACKAGE_SRCDIR="${SWIFT_PACKAGE_SRCDIR:=$SRC_ROOT/swift-hello}"
SWIFT_PACKAGE_BUILDDIR="${SWIFT_PACKAGE_BUILDDIR:=$SWIFT_PACKAGE_SRCDIR/.build}"

# Build Paths
SWIFT_SRCDIR=$SRC_ROOT/downloads/swift-swift-${SWIFT_VERSION}-RELEASE
SWIFT_BUILDDIR=$SRC_ROOT/build/swift-$SWIFT_TARGET_ARCH
SWIFT_INSTALL_PREFIX=$SRC_ROOT/build/swift-$SWIFT_TARGET_ARCH-install/usr
LIBDISPATCH_SRCDIR=$SRC_ROOT/downloads/swift-corelibs-libdispatch-swift-${SWIFT_VERSION}-RELEASE
LIBDISPATCH_BUILDDIR=$SRC_ROOT/build/libdispatch-$SWIFT_TARGET_ARCH
LIBDISPATCH_INSTALL_PREFIX=$SRC_ROOT/build/libdispatch-$SWIFT_TARGET_ARCH-install/usr
FOUNDATION_SRCDIR=$SRC_ROOT/downloads/swift-corelibs-foundation-swift-${SWIFT_VERSION}-RELEASE
FOUNDATION_BUILDDIR=$SRC_ROOT/build/foundation-$SWIFT_TARGET_ARCH
FOUNDATION_INSTALL_PREFIX=$SRC_ROOT/build/foundation-$SWIFT_TARGET_ARCH-install/usr
XCTEST_SRCDIR=$SRC_ROOT/downloads/swift-corelibs-xctest-swift-${SWIFT_VERSION}-RELEASE
XCTEST_BUILDDIR=$SRC_ROOT/build/xctest-$SWIFT_TARGET_ARCH
XCTEST_INSTALL_PREFIX=$SRC_ROOT/build/xctest-$SWIFT_TARGET_ARCH-install/usr
SWIFTPM_DESTINATION_FILE=$SRC_ROOT/build/$SWIFT_TARGET_NAME-toolchain.json
INSTALL_PREFIX=$SRC_ROOT/build/swift-install/usr
INSTALL_TAR=$SRC_ROOT/build/swift-$SWIFT_TARGET_ARCH.tar.gz

# Compilation flags
EXTRA_INCLUDE_FLAGS="-I${STAGING_DIR}/usr/include"
RUNTIME_FLAGS="-w -fuse-ld=lld --sysroot=${STAGING_DIR} -target ${SWIFT_TARGET_NAME} -march=armv7-a -mthumb -mfpu=neon -mfloat-abi=hard -B${STAGING_DIR}/usr/lib -B${STAGING_DIR}/lib -B${STAGING_DIR}/usr/lib/arm-linux-gnueabihf -B${STAGING_DIR}/lib/arm-linux-gnueabihf -B${STAGING_DIR}/usr/lib/gcc/arm-linux-gnueabihf/10"
LINK_FLAGS="--sysroot=${STAGING_DIR} -target ${SWIFT_TARGET_NAME} -march=armv7-a -mthumb -mfpu=neon -mfloat-abi=hard -latomic"
ASM_FLAGS="--sysroot=${STAGING_DIR} -target ${SWIFT_TARGET_NAME}"

SWIFTC_FLAGS="-target ${SWIFT_TARGET_NAME} -use-ld=lld \
-resource-dir ${STAGING_DIR}/usr/lib/swift \
-Xclang-linker -B${STAGING_DIR}/usr/lib \
-Xclang-linker -B${STAGING_DIR}/usr/lib/gcc/arm-linux-gnueabihf/10 \
-Xcc -I${STAGING_DIR}/usr/include \
-Xcc -I${STAGING_DIR}/usr/lib/gcc/arm-linux-gnueabihf/10/include \
-L${STAGING_DIR}/lib \
-L${STAGING_DIR}/usr/lib \
-L${STAGING_DIR}/usr/lib/swift \
-L${STAGING_DIR}/usr/lib/swift/linux \
-L${STAGING_DIR}/usr/lib/gcc/arm-linux-gnueabihf/10 \
-sdk ${STAGING_DIR} \
"
